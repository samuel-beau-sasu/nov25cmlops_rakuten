schema: '2.0'
stages:
  seed:
    cmd: python mlops_rakuten/pipelines/data_seeding.py
    deps:
    - path: data/raw/product_categories.csv
      hash: md5
      md5: 1623c8de2d17e200fc3fa76ebebbbc4e
      size: 631
    - path: data/raw/rakuten/X_train_update.csv
      hash: md5
      md5: c936389910c88bb29bf2c438af3476df
      size: 54129120
    - path: data/raw/rakuten/Y_train_CVw08PX.csv
      hash: md5
      md5: 52d45c998ddc0c10f05987bb233ff5e7
      size: 906705
    - path: mlops_rakuten/config/config.yml
      hash: md5
      md5: 9a5c628333e26bb475c23858e239bcfb
      size: 3224
    - path: mlops_rakuten/main.py
      hash: md5
      md5: fa484adb23fd5eccb75bed2a67726ce8
      size: 3960
    - path: mlops_rakuten/modules/data_seeding.py
      hash: md5
      md5: 80990a12711960846c7c5b44b58f4b74
      size: 4999
    - path: mlops_rakuten/pipelines/data_seeding.py
      hash: md5
      md5: b83b06f5a56b60966d627d3f5e6bf0db
      size: 871
    params:
      mlops_rakuten/config/config.yml:
        data_seeding:
          x_train_filename: X_train_update.csv
          y_train_filename: Y_train_CVw08PX.csv
          output_full_dataset_filename: rakuten_dataset_full.csv
          output_remainder_dataset_filename: rakuten_dataset_remainder.csv
          output_dataset_filename: rakuten_train.csv
          output_current_dataset_filename: rakuten_train_current.csv
          text_column: designation
          target_column: prdtypecode
          batch_size: 1000
          n_batches: 10
    outs:
    - path: data/interim/rakuten_train.csv
      hash: md5
      md5: dfcb929e3862f855714af8cd33be8ae2
      size: 5782684
    - path: data/raw/rakuten/seeds/rakuten_batch_0001.csv
      hash: md5
      md5: e6c9cfef46850233ebcf781f4a9e1af8
      size: 78518
    - path: data/raw/rakuten/seeds/rakuten_batch_0002.csv
      hash: md5
      md5: d08c2ae328a72d2a481b613799256990
      size: 79245
    - path: data/raw/rakuten/seeds/rakuten_batch_0003.csv
      hash: md5
      md5: 23b564024a8bab4e332d50f983d08510
      size: 75698
    - path: data/raw/rakuten/seeds/rakuten_batch_0004.csv
      hash: md5
      md5: 5eb6441456e0ecfbcc1b34da2f3c363d
      size: 78282
    - path: data/raw/rakuten/seeds/rakuten_batch_0005.csv
      hash: md5
      md5: 10773f44a0d5bb7d54ee58b681c704d6
      size: 76362
    - path: data/raw/rakuten/seeds/rakuten_batch_0006.csv
      hash: md5
      md5: 64f6233bfdd6e55d6ccfd971b3ca1f6b
      size: 76963
    - path: data/raw/rakuten/seeds/rakuten_batch_0007.csv
      hash: md5
      md5: 318a076594c76f3de9f3d82cab129f9d
      size: 78236
    - path: data/raw/rakuten/seeds/rakuten_batch_0008.csv
      hash: md5
      md5: 118c64aa32e399f7cc8d3379f2c38c77
      size: 78615
    - path: data/raw/rakuten/seeds/rakuten_batch_0009.csv
      hash: md5
      md5: f60c5223494b30474ec888e733d86b2c
      size: 78503
    - path: data/raw/rakuten/seeds/rakuten_batch_0010.csv
      hash: md5
      md5: d7eaba592f4595001f89681d8fe3d5cb
      size: 79210
    - path: data/raw/rakuten/seeds/rakuten_dataset_full.csv
      hash: md5
      md5: e8ee50889f16cb234a2fbb684e2f3560
      size: 6562076
    - path: data/raw/rakuten/seeds/rakuten_dataset_remainder.csv
      hash: md5
      md5: dfcb929e3862f855714af8cd33be8ae2
      size: 5782684
  preprocess:
    cmd: python mlops_rakuten/pipelines/data_preprocessing.py
    deps:
    - path: data/interim/rakuten_train_current.csv
      hash: md5
      md5: 86db910e3efc45197c3fce0faacaf697
      size: 5680945
    - path: mlops_rakuten/config/config.yml
      hash: md5
      md5: 9a5c628333e26bb475c23858e239bcfb
      size: 3224
    - path: mlops_rakuten/modules/data_preprocessing.py
      hash: md5
      md5: 2beb1cc096fde664caf435decd941aec
      size: 4519
    - path: mlops_rakuten/pipelines/data_preprocessing.py
      hash: md5
      md5: c46794013e6157954fb7d5aeddf05766
      size: 947
    params:
      mlops_rakuten/config/config.yml:
        data_preprocessing:
          input_dataset_filename: rakuten_train_current.csv
          output_dataset_filename: preprocessed_dataset.csv
          text_column: designation
          target_column: prdtypecode
          drop_na_text: true
          drop_na_target: true
          drop_duplicates: true
          min_char_length: 10
          max_char_length: 200
          min_alpha_ratio: 0.2
    outs:
    - path: data/interim/preprocessed_dataset.csv
      hash: md5
      md5: 5c03c46af7c1651f4194edc7d84bedd4
      size: 5480073
  transform:
    cmd: python mlops_rakuten/pipelines/data_transformation.py
    deps:
    - path: data/interim/preprocessed_dataset.csv
      hash: md5
      md5: 5c03c46af7c1651f4194edc7d84bedd4
      size: 5480073
    - path: mlops_rakuten/config/config.yml
      hash: md5
      md5: 9a5c628333e26bb475c23858e239bcfb
      size: 3224
    - path: mlops_rakuten/modules/data_transformation.py
      hash: md5
      md5: b60ca040d807a9dd591f01896406b17d
      size: 5214
    - path: mlops_rakuten/pipelines/data_transformation.py
      hash: md5
      md5: b2cc46abbc274154fec57a8645297008
      size: 1053
    params:
      mlops_rakuten/config/config.yml:
        data_transformation:
          input_dataset_filename: preprocessed_dataset.csv
          text_column: designation
          target_column: prdtypecode
          test_size: 0.2
          random_state: 42
          stratify: true
          max_features: 20000
          ngram_min: 1
          ngram_max: 2
          lowercase: true
          stop_words: english
          label_encoder_filename: label_encoder.pkl
          class_mapping_filename: class_mapping.json
          vectorizer_filename: tfidf_vectorizer.pkl
          X_train_filename: X_train_tfidf.npz
          X_val_filename: X_val_tfidf.npz
          y_train_filename: y_train.npy
          y_val_filename: y_val.npy
    outs:
    - path: data/processed/X_train_tfidf.npz
      hash: md5
      md5: aaa013f5935b541b2675264479c35ba7
      size: 5828040
    - path: data/processed/X_val_tfidf.npz
      hash: md5
      md5: 5af8f81f8d87bfbf06f982a64962ff15
      size: 1410550
    - path: data/processed/class_mapping.json
      hash: md5
      md5: 1e3fc6fa70ee1316c3a22acbd76af9d3
      size: 362
    - path: data/processed/label_encoder.pkl
      hash: md5
      md5: 90b1c5ed8b7d4bfb9f3411404f218018
      size: 458
    - path: data/processed/tfidf_vectorizer.pkl
      hash: md5
      md5: 81c402999a7c1884968ae082f5c8d69d
      size: 778040
    - path: data/processed/y_train.npy
      hash: md5
      md5: 199de277e27a4e950bdbc3923021c12a
      size: 467520
    - path: data/processed/y_val.npy
      hash: md5
      md5: e452bb707ae3ae31f37d6289659b3a44
      size: 116976
  train:
    cmd: python mlops_rakuten/pipelines/model_trainer.py
    deps:
    - path: data/processed/X_train_tfidf.npz
      hash: md5
      md5: aaa013f5935b541b2675264479c35ba7
      size: 5828040
    - path: data/processed/y_train.npy
      hash: md5
      md5: 199de277e27a4e950bdbc3923021c12a
      size: 467520
    - path: mlops_rakuten/config/config.yml
      hash: md5
      md5: 9a5c628333e26bb475c23858e239bcfb
      size: 3224
    - path: mlops_rakuten/modules/model_trainer.py
      hash: md5
      md5: 3a99c4d6360c784511ba602672f593c4
      size: 5637
    - path: mlops_rakuten/pipelines/model_trainer.py
      hash: md5
      md5: cc478012fb45ebf692d5df244eb6dcdc
      size: 883
    params:
      mlops_rakuten/config/config.yml:
        model_trainer:
          model_filename: text_classifier.pkl
          X_train_filename: X_train_tfidf.npz
          y_train_filename: y_train.npy
          model_type: logistic_regression
          C: 1.0
          max_iter: 2000
          use_class_weight: true
    outs:
    - path: models/classification_report_train.txt
      hash: md5
      md5: 8556e3371bf438f821c25f6935023584
      size: 1676
    - path: models/metrics_train.json
      hash: md5
      md5: 754e5d3cd91236eb3bdf60e1deb0b5bd
      size: 80
    - path: models/model_config.json
      hash: md5
      md5: 8d38fdc487d54be3937b4bf8512e1297
      size: 348
    - path: models/text_classifier.pkl
      hash: md5
      md5: 6649b1616c2287ea9f6b5a68d6d83dc6
      size: 4321152
  evaluate:
    cmd: python mlops_rakuten/pipelines/model_evaluation.py
    deps:
    - path: mlops_rakuten/config/config.yml
      hash: md5
      md5: 9a5c628333e26bb475c23858e239bcfb
      size: 3224
    - path: mlops_rakuten/modules/model_evaluation.py
      hash: md5
      md5: f7fec46dcb9445a338c7c91f77481830
      size: 3526
    - path: mlops_rakuten/pipelines/model_evaluation.py
      hash: md5
      md5: 458d268a040487447f10f3eccd16d068
      size: 990
    - path: models/text_classifier.pkl
      hash: md5
      md5: 6649b1616c2287ea9f6b5a68d6d83dc6
      size: 4321152
    params:
      mlops_rakuten/config/config.yml:
        model_evaluation:
          model_filename: text_classifier.pkl
          X_val_filename: X_val_tfidf.npz
          y_val_filename: y_val.npy
          metrics_filename: metrics_val.json
          classification_report_filename: classification_report_val.txt
          confusion_matrix_filename: confusion_matrix_val.txt
    outs:
    - path: reports/classification_report_val.txt
      hash: md5
      md5: f2c0d4c8966a86ee811cb78d7c575645
      size: 1676
    - path: reports/confusion_matrix_val.txt
      hash: md5
      md5: 9d8f119230e470dc6e55afa8d2d828fd
      size: 3780
    - path: reports/metrics_val.json
      hash: md5
      md5: 7dc65c8bbab6dfec457d15b46a36ff11
      size: 119
