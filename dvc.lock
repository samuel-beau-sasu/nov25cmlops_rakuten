schema: '2.0'
stages:
  seed:
    cmd: python mlops_rakuten/pipelines/data_seeding.py
    deps:
    - path: data/raw/product_categories.csv
      hash: md5
      md5: 1623c8de2d17e200fc3fa76ebebbbc4e
      size: 631
    - path: data/raw/rakuten/X_train_update.csv
      hash: md5
      md5: c936389910c88bb29bf2c438af3476df
      size: 54129120
    - path: data/raw/rakuten/Y_train_CVw08PX.csv
      hash: md5
      md5: 52d45c998ddc0c10f05987bb233ff5e7
      size: 906705
    - path: mlops_rakuten/config/config.yml
      hash: md5
      md5: 9a5c628333e26bb475c23858e239bcfb
      size: 3224
    - path: mlops_rakuten/main.py
      hash: md5
      md5: 09cc6b06547dc281b91168d67badb330
      size: 2631
    - path: mlops_rakuten/modules/data_seeding.py
      hash: md5
      md5: 80990a12711960846c7c5b44b58f4b74
      size: 4999
    - path: mlops_rakuten/pipelines/data_seeding.py
      hash: md5
      md5: b83b06f5a56b60966d627d3f5e6bf0db
      size: 871
    params:
      mlops_rakuten/config/config.yml:
        data_seeding:
          x_train_filename: X_train_update.csv
          y_train_filename: Y_train_CVw08PX.csv
          output_full_dataset_filename: rakuten_dataset_full.csv
          output_remainder_dataset_filename: rakuten_dataset_remainder.csv
          output_dataset_filename: rakuten_train.csv
          output_current_dataset_filename: rakuten_train_current.csv
          text_column: designation
          target_column: prdtypecode
          batch_size: 1000
          n_batches: 10
    outs:
    - path: data/interim/rakuten_train.csv
      hash: md5
      md5: dfcb929e3862f855714af8cd33be8ae2
      size: 5782684
    - path: data/raw/rakuten/seeds/rakuten_batch_0001.csv
      hash: md5
      md5: e6c9cfef46850233ebcf781f4a9e1af8
      size: 78518
    - path: data/raw/rakuten/seeds/rakuten_batch_0002.csv
      hash: md5
      md5: d08c2ae328a72d2a481b613799256990
      size: 79245
    - path: data/raw/rakuten/seeds/rakuten_batch_0003.csv
      hash: md5
      md5: 23b564024a8bab4e332d50f983d08510
      size: 75698
    - path: data/raw/rakuten/seeds/rakuten_batch_0004.csv
      hash: md5
      md5: 5eb6441456e0ecfbcc1b34da2f3c363d
      size: 78282
    - path: data/raw/rakuten/seeds/rakuten_batch_0005.csv
      hash: md5
      md5: 10773f44a0d5bb7d54ee58b681c704d6
      size: 76362
    - path: data/raw/rakuten/seeds/rakuten_batch_0006.csv
      hash: md5
      md5: 64f6233bfdd6e55d6ccfd971b3ca1f6b
      size: 76963
    - path: data/raw/rakuten/seeds/rakuten_batch_0007.csv
      hash: md5
      md5: 318a076594c76f3de9f3d82cab129f9d
      size: 78236
    - path: data/raw/rakuten/seeds/rakuten_batch_0008.csv
      hash: md5
      md5: 118c64aa32e399f7cc8d3379f2c38c77
      size: 78615
    - path: data/raw/rakuten/seeds/rakuten_batch_0009.csv
      hash: md5
      md5: f60c5223494b30474ec888e733d86b2c
      size: 78503
    - path: data/raw/rakuten/seeds/rakuten_batch_0010.csv
      hash: md5
      md5: d7eaba592f4595001f89681d8fe3d5cb
      size: 79210
    - path: data/raw/rakuten/seeds/rakuten_dataset_full.csv
      hash: md5
      md5: e8ee50889f16cb234a2fbb684e2f3560
      size: 6562076
    - path: data/raw/rakuten/seeds/rakuten_dataset_remainder.csv
      hash: md5
      md5: dfcb929e3862f855714af8cd33be8ae2
      size: 5782684
  preprocess:
    cmd: python mlops_rakuten/pipelines/data_preprocessing.py
    deps:
    - path: data/interim/rakuten_train_current.csv
      hash: md5
      md5: d8489dc59570ddfb732e64531a15b320
      size: 6123627
    - path: mlops_rakuten/config/config.yml
      hash: md5
      md5: 9a5c628333e26bb475c23858e239bcfb
      size: 3224
    - path: mlops_rakuten/modules/data_preprocessing.py
      hash: md5
      md5: 2beb1cc096fde664caf435decd941aec
      size: 4519
    - path: mlops_rakuten/pipelines/data_preprocessing.py
      hash: md5
      md5: c46794013e6157954fb7d5aeddf05766
      size: 947
    params:
      mlops_rakuten/config/config.yml:
        data_preprocessing:
          input_dataset_filename: rakuten_train_current.csv
          output_dataset_filename: preprocessed_dataset.csv
          text_column: designation
          target_column: prdtypecode
          drop_na_text: true
          drop_na_target: true
          drop_duplicates: true
          min_char_length: 10
          max_char_length: 200
          min_alpha_ratio: 0.2
    outs:
    - path: data/interim/preprocessed_dataset.csv
      hash: md5
      md5: 134267ae15eb4f8b23297a13c0c17d5f
      size: 5906044
  transform:
    cmd: python mlops_rakuten/pipelines/data_transformation.py
    deps:
    - path: data/interim/preprocessed_dataset.csv
      hash: md5
      md5: 134267ae15eb4f8b23297a13c0c17d5f
      size: 5906044
    - path: mlops_rakuten/config/config.yml
      hash: md5
      md5: 9a5c628333e26bb475c23858e239bcfb
      size: 3224
    - path: mlops_rakuten/modules/data_transformation.py
      hash: md5
      md5: b60ca040d807a9dd591f01896406b17d
      size: 5214
    - path: mlops_rakuten/pipelines/data_transformation.py
      hash: md5
      md5: b2cc46abbc274154fec57a8645297008
      size: 1053
    params:
      mlops_rakuten/config/config.yml:
        data_transformation:
          input_dataset_filename: preprocessed_dataset.csv
          text_column: designation
          target_column: prdtypecode
          test_size: 0.2
          random_state: 42
          stratify: true
          max_features: 20000
          ngram_min: 1
          ngram_max: 2
          lowercase: true
          stop_words: english
          label_encoder_filename: label_encoder.pkl
          class_mapping_filename: class_mapping.json
          vectorizer_filename: tfidf_vectorizer.pkl
          X_train_filename: X_train_tfidf.npz
          X_val_filename: X_val_tfidf.npz
          y_train_filename: y_train.npy
          y_val_filename: y_val.npy
    outs:
    - path: data/processed/X_train_tfidf.npz
      hash: md5
      md5: 06f79582a46f30434bddc2e7eea26588
      size: 6283312
    - path: data/processed/X_val_tfidf.npz
      hash: md5
      md5: 99f78c0eb06e479ac858996ba70893dd
      size: 1520215
    - path: data/processed/class_mapping.json
      hash: md5
      md5: 1e3fc6fa70ee1316c3a22acbd76af9d3
      size: 362
    - path: data/processed/label_encoder.pkl
      hash: md5
      md5: 90b1c5ed8b7d4bfb9f3411404f218018
      size: 458
    - path: data/processed/tfidf_vectorizer.pkl
      hash: md5
      md5: d0ebe4826241d9a3b1c6fa688e4df849
      size: 778091
    - path: data/processed/y_train.npy
      hash: md5
      md5: 4009536ac7628710951d9103426740ce
      size: 503608
    - path: data/processed/y_val.npy
      hash: md5
      md5: 99758746d13c5921365a3d8ba0e200c8
      size: 126000
  train:
    cmd: python mlops_rakuten/pipelines/model_trainer.py
    deps:
    - path: data/processed/X_train_tfidf.npz
      hash: md5
      md5: 06f79582a46f30434bddc2e7eea26588
      size: 6283312
    - path: data/processed/y_train.npy
      hash: md5
      md5: 4009536ac7628710951d9103426740ce
      size: 503608
    - path: mlops_rakuten/config/config.yml
      hash: md5
      md5: 9a5c628333e26bb475c23858e239bcfb
      size: 3224
    - path: mlops_rakuten/modules/model_trainer.py
      hash: md5
      md5: 34dcffa7b62ecc769d8a656c58c4e22d
      size: 6537
    - path: mlops_rakuten/pipelines/model_trainer.py
      hash: md5
      md5: 513e2b76dd371b9eff6522e1a3ce1719
      size: 7552
    params:
      mlops_rakuten/config/config.yml:
        model_trainer:
          model_filename: text_classifier.pkl
          X_train_filename: X_train_tfidf.npz
          y_train_filename: y_train.npy
          model_type: logistic_regression
          C: 1.0
          max_iter: 2000
          use_class_weight: true
    outs:
    - path: models/classification_report_train.txt
      hash: md5
      md5: 329454eb100552c2869c838735cb47b8
      size: 1676
    - path: models/metrics_train.json
      hash: md5
      md5: d2eac0087e30c4ec9f3d395f2a9de05b
      size: 82
    - path: models/model_config.json
      hash: md5
      md5: 2dcd287739340686d303fe3085eb44ae
      size: 375
    - path: models/text_classifier.pkl
      hash: md5
      md5: c49a8ecc228bec46153d8e8b5f026339
      size: 4321152
  evaluate:
    cmd: python mlops_rakuten/pipelines/model_evaluation.py
    deps:
    - path: mlops_rakuten/config/config.yml
      hash: md5
      md5: 9a5c628333e26bb475c23858e239bcfb
      size: 3224
    - path: mlops_rakuten/modules/model_evaluation.py
      hash: md5
      md5: e81797afae78699f8d239fce326a4298
      size: 4250
    - path: mlops_rakuten/pipelines/model_evaluation.py
      hash: md5
      md5: 4f904e935f25522988424c66fc155af4
      size: 2007
    - path: models/text_classifier.pkl
      hash: md5
      md5: c49a8ecc228bec46153d8e8b5f026339
      size: 4321152
    params:
      mlops_rakuten/config/config.yml:
        model_evaluation:
          model_filename: text_classifier.pkl
          X_val_filename: X_val_tfidf.npz
          y_val_filename: y_val.npy
          metrics_filename: metrics_val.json
          classification_report_filename: classification_report_val.txt
          confusion_matrix_filename: confusion_matrix_val.txt
    outs:
    - path: reports/classification_report_val.txt
      hash: md5
      md5: caf67ae7a4f9dc7dc20b145eb044b38e
      size: 1676
    - path: reports/confusion_matrix_val.txt
      hash: md5
      md5: 8770d9d731a529bbe7c2c233717aa50b
      size: 3780
    - path: reports/metrics_val.json
      hash: md5
      md5: d4a3bf00147e1c1ba82673fcdc9cb460
      size: 119
