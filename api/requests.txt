# Activation de l'environnement virtuel dans le répertoire : nov25cmlops_rakuten
source .venv/bin/activate

# On ajoute les librairies
uv add uvicorn[standard]
uv add pandas[standard]
uv add python-multipart[standard]
uv add loguru[standard]
uv add typer[standard]
uv add scipy[standard]
uv add scikit-learn[standard]
uv add pytest[standard]
uv add requests[standard]
requests

uv sync

# demarrer l'appli dans le répertoire nov25cmlops_rakuten
uv run uvicorn api.api_main:app

## GIT 
git add .
git commit -m "version 1"
git push -u origin feature/api

## Test CURL
# 1. test de la page de bienvenue de l'appli
curl -X 'GET' \
  'http://localhost:8000/' \
  -H 'accept: application/json'

# 2. Endpoint de santé de l'API
curl -X 'GET' \
  'http://localhost:8000/health' \
  -H 'accept: application/json'

# 3. Admin Charge les données ET entraîne le modèle en une seule opération.
curl -X POST "http://localhost:8000/admin/load-and-train" \
  -u admin:4dm1N \
  -F "x_train_file=@data/raw/X_train_update.csv" \
  -F "y_train_file=@data/raw/Y_train_CVw08PX.csv"

# 4. Affiche le statut des données d'entraînement chargées.
curl -X 'GET' \
  'http://localhost:8000/admin/training-job/7fb0c973-f70b-4e1c-8182-4d6099660545' \
  -u admin:4dm1N \
  -H 'accept: application/json'

# 5. Liste tous les jobs de training
curl -X 'GET' \
  'http://localhost:8000/admin/training-jobs' \
  -u admin:4dm1N \
  -H 'accept: application/json'

# 6. Effectue des prédictions sur un texte
curl -X 'POST' \
  'http://localhost:8000/predict' \
  -u alice:wonderland \
  -H 'accept: application/json' \
  -H 'Content-Type: application/json' \
  -d '{
  "texts": [
    "Porte Flamme Gaxix - Flamebringer Gaxix - 136/220 - U - Twilight Of The Dragons"
  ]
}'

# tests 
pytest tests/test_api.py -v




